define(function(require,exports){var isFlashReady=!1,lockFlash=!1,Cookie={cookieArr:{},options:{domain:".miduoduo.cn",path:"/"},setCookie:function(key,value,opts){opts=opts||{};var line=key+"="+encodeURIComponent(value);if(opts.domain||(opts.domain=this.options.domain),opts.path||(opts.path=this.options.path),line+="; domain="+opts.domain,opts.path&&(line+="; path="+opts.path),opts.duration){var expires=new Date;expires.setTime(expires.getTime()+1e3*opts.duration),line+="; expires="+expires.toGMTString()}return opts.secure&&(line+="; secure"),document.cookie=line+";"},getCookie:function(key,cbk){this.cookieArr[key]=this.cookieArr[key]||function(){"string"!=typeof key&&(key=key.toString());var arr=window.document.cookie.match("(?:^|;)\\s*"+key.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")+"=([^;]*)");return arr?decodeURIComponent(arr[1]):void 0}();var val=this.cookieArr[key];return cbk?cbk(val):val},removeCookie:function(key){return this.setCookie(key,"",{duration:-1})}},DOMStorage={set:function(key,value,session,fun){session?sessionStorage.setItem(key,value):localStorage.setItem(key,value),"function"==typeof fun&&fun()},get:function(key,session,fun){try{fun(session?sessionStorage.getItem(key):localStorage.getItem(key))}catch(err){}},remove:function(key,session){session?sessionStorage.removeItem(key):localStorage.removeItem(key)}},IEStorage={flash:document.getElementById("storage"),sessionId:"",callback:[],init:function(session){if(session&&(this.sessionId=this.sessionId||Cookie.getCookie("PHPSESSID")),!isFlashReady&&!lockFlash){lockFlash=!0;var flashDiv=(new Date,document.createElement("div")),html='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="storage"';html+='codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0" width="1" height="1">',html+='<param name="movie" value="http://i.meilishuo.net/css/images/window/storage1.swf" />',html+='<param name="quality" value="high" />',html+='<param name="allowScriptAccess" value="always" />',html+="</object>",flashDiv.innerHTML=html,document.body.appendChild(flashDiv),this.flash=document.getElementById("storage")}},detectIE:function(){var ua=navigator.userAgent.toLowerCase();if(window.ActiveXObject){var ieVersion=ua.match(/msie ([\d.]+)/)[1];if(ieVersion>=5.5&&8>ieVersion)return!0}return!1},set:function(key,value,session,fun){function setVal(key,value,session){if(session){var now=new Date;now=parseInt(now.getTime()/36e5),self.flash.setSessionTime(now),self.flash.setSessionVal(self.sessionId+key,now),self.flash.set(self.sessionId+key,value)}else self.flash.set(key,value)}var self=this;self.init(session),isFlashReady?(setVal(key,value,session),"function"==typeof fun&&fun()):self.callback.push(function(){setVal(key,value,session),"function"==typeof fun&&fun()})},get:function(key,session,fun){function getVal(key,session){return session?(self.flash.removeAllSession(),self.flash.get(self.sessionId+key)):self.flash.get(key)}var self=this;self.init(session),isFlashReady?fun(getVal(key,session)):self.callback.push(function(){fun(getVal(key,session))})},remove:function(key,session){var self=this;if(self.init(session),!isFlashReady){var self=this;return void window.setTimeout(function(){self.remove(key,session)},100)}session?self.flash.remove(self.sessionId+key):self.flash.remove(key)}},CookieStorage={set:function(key,value,session,fun){session?Cookie.setCookie(key,value):Cookie.setCookie(key,value,{duration:15552e3}),"function"==typeof fun&&fun()},get:function(key,session,fun){fun(Cookie.getCookie(key))},remove:function(key,session){Cookie.removeCookie(key)}},storage=IEStorage.detectIE()?function(){try{var swf=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");return swf?IEStorage:CookieStorage}catch(e){return CookieStorage}}():DOMStorage;return{isJSReady:function(){return!0},getAllowDomain:function(){var domains=domains||["www.meilishuo.com","newlab.meilishuo.com","newtest.meilishuo.com","wwwtest.meilishuo.com","cdjdev.meilishuo.com","xhdev.meilishuo.com","rwdev.meilishuo.com","nanodev.meilishuo.com"];return domains},flashReadyHandler:function(){isFlashReady=!0;for(var i=0,len=IEStorage.callback.length;len>i;i++)IEStorage.callback[i]()},setCookie:function(key,value,opts){return Cookie.setCookie(key,value,opts)},getCookie:function(key,cbk){return Cookie.getCookie(key,cbk)},removeCookie:function(key){return Cookie.removeCookie(key)},setSession:function(key,value,fun){return storage.set(key,value,!0,fun)},getSession:function(key,fun){return storage.get(key,!0,fun)},removeSession:function(key){return storage.remove(key,!0)},set:function(key,value,fun){return storage.set(key,value,!1,fun)},get:function(key,fun){return storage.get(key,!1,fun)},remove:function(key){return storage.remove(key,!1)}}});