!function($){var defaults={inputClass:"",invalid:[],rtl:!1,group:!1,groupLabel:"Groups"};$.mobiscroll.presetShort("select"),$.mobiscroll.presets.select=function(inst){function genWheels(){var cont,wg=0,values=[],keys=[],w=[[]];return s.group?(s.rtl&&(wg=1),$("optgroup",elm).each(function(i){values.push($(this).attr("label")),keys.push(i)}),w[wg]=[{values:values,keys:keys,label:s.groupLabel}],cont=group,wg+=s.rtl?-1:1):cont=elm,values=[],keys=[],$("option",cont).each(function(){var v=$(this).attr("value");values.push($(this).text()),keys.push(v),$(this).prop("disabled")&&invalid.push(v)}),w[wg]=[{values:values,keys:keys,label:label}],w}function setVal(v,fill){var value=[];if(multiple){var sel=[],i=0;for(i in inst._selectedValues)sel.push(main[i]),value.push(i);input.val(sel.join(", "))}else input.val(v),value=fill?inst.values[optIdx]:null;fill&&(prevent=!0,elm.val(value).change())}function onTap(li){if(multiple&&li.hasClass("dw-v")&&li.closest(".dw").find(".dw-ul").index(li.closest(".dw-ul"))==optIdx){var val=li.attr("data-val"),selected=li.hasClass("dw-msel");return selected?(li.removeClass("dw-msel").removeAttr("aria-selected"),delete inst._selectedValues[val]):(li.addClass("dw-msel").attr("aria-selected","true"),inst._selectedValues[val]=val),inst.live&&setVal(val,!0),!1}}var prevent,grIdx,optIdx,timer,input,w,orig=$.extend({},inst.settings),s=$.extend(inst.settings,defaults,orig),elm=$(this),multiple=elm.prop("multiple"),id=this.id+"_dummy",option=multiple?elm.val()?elm.val()[0]:$("option",elm).attr("value"):elm.val(),group=elm.find('option[value="'+option+'"]').parent(),prev=group.index()+"",gr=prev,l2=($('label[for="'+this.id+'"]').attr("for",id),$('label[for="'+id+'"]')),label=void 0!==s.label?s.label:l2.length?l2.text():elm.attr("name"),invalid=[],origValues=[],main={},roPre=s.readonly;s.group&&!$("optgroup",elm).length&&(s.group=!1),s.invalid.length||(s.invalid=invalid),s.group?s.rtl?(grIdx=1,optIdx=0):(grIdx=0,optIdx=1):(grIdx=-1,optIdx=0),$("#"+id).remove(),input=$('<input type="text" id="'+id+'" class="'+s.inputClass+'" readonly />').insertBefore(elm),$("option",elm).each(function(){main[$(this).attr("value")]=$(this).text()}),inst.attachShow(input);var v=elm.val()||[],i=0;for(i;i<v.length;i++)inst._selectedValues[v[i]]=v[i];return setVal(main[option]),elm.off(".dwsel").on("change.dwsel",function(){prevent||inst.setValue(multiple?elm.val()||[]:[elm.val()],!0),prevent=!1}).addClass("dw-hsel").attr("tabindex",-1).closest(".ui-field-contain").trigger("create"),inst._setValue||(inst._setValue=inst.setValue),inst.setValue=function(d,fill,time,noscroll,temp){var value,v=$.isArray(d)?d[0]:d;if(option=void 0!==v?v:$("option",elm).attr("value"),multiple){inst._selectedValues={};var i=0;for(i;i<d.length;i++)inst._selectedValues[d[i]]=d[i]}if(s.group?(group=elm.find('option[value="'+option+'"]').parent(),gr=group.index(),value=s.rtl?[option,group.index()]:[group.index(),option],gr!==prev&&(s.wheels=genWheels(),inst.changeWheel([optIdx]),prev=gr+"")):value=[option],inst._setValue(value,fill,time,noscroll,temp),fill){var changed=multiple?!0:option!==elm.val();setVal(main[option],changed)}},inst.getValue=function(temp){var val=temp?inst.temp:inst.values;return val[optIdx]},{width:50,wheels:w,headerText:!1,multiple:multiple,anchor:input,formatResult:function(d){return main[d[optIdx]]},parseValue:function(){var v=elm.val()||[],i=0;if(multiple)for(inst._selectedValues={},i;i<v.length;i++)inst._selectedValues[v[i]]=v[i];return option=multiple?elm.val()?elm.val()[0]:$("option",elm).attr("value"):elm.val(),group=elm.find('option[value="'+option+'"]').parent(),gr=group.index(),prev=gr+"",s.group&&s.rtl?[option,gr]:s.group?[gr,option]:[option]},validate:function(dw,i,time){if(void 0===i&&multiple){var v=inst._selectedValues,j=0;$(".dwwl"+optIdx+" .dw-li",dw).removeClass("dw-msel").removeAttr("aria-selected");for(j in v)$(".dwwl"+optIdx+' .dw-li[data-val="'+v[j]+'"]',dw).addClass("dw-msel").attr("aria-selected","true")}if(i===grIdx)if(gr=inst.temp[grIdx],gr!==prev){if(group=elm.find("optgroup").eq(gr),gr=group.index(),option=group.find("option").eq(0).val(),option=option||elm.val(),s.wheels=genWheels(),s.group)return inst.temp=s.rtl?[option,gr]:[gr,option],s.readonly=[s.rtl,!s.rtl],clearTimeout(timer),timer=setTimeout(function(){inst.changeWheel([optIdx],void 0,!0),s.readonly=roPre,prev=gr+""},1e3*time),!1}else s.readonly=roPre;else option=inst.temp[optIdx];var t=$(".dw-ul",dw).eq(optIdx);$.each(s.invalid,function(i,v){$('.dw-li[data-val="'+v+'"]',t).removeClass("dw-v")})},onBeforeShow:function(dw){multiple&&s.counter&&(s.headerText=function(){var length=0;return $.each(inst._selectedValues,function(){length++}),length+" "+s.selectedText}),s.wheels=genWheels(),s.group&&(inst.temp=s.rtl?[option,group.index()]:[group.index(),option])},onClear:function(dw){inst._selectedValues={},input.val(""),$(".dwwl"+optIdx+" .dw-li",dw).removeClass("dw-msel").removeAttr("aria-selected")},onMarkupReady:function(dw){dw.addClass("dw-select"),$(".dwwl"+grIdx,dw).on("mousedown touchstart",function(){clearTimeout(timer)}),multiple&&(dw.addClass("dwms"),$(".dwwl",dw).eq(optIdx).addClass("dwwms").attr("aria-multiselectable","true"),$(".dwwl",dw).on("keydown",function(e){32==e.keyCode&&(e.preventDefault(),e.stopPropagation(),onTap($(".dw-sel",this)))}),origValues=$.extend({},inst._selectedValues))},onValueTap:onTap,onSelect:function(v){setVal(v,!0),s.group&&(inst.values=null)},onCancel:function(){s.group&&(inst.values=null),!inst.live&&multiple&&(inst._selectedValues=$.extend({},origValues))},onChange:function(v){inst.live&&!multiple&&(input.val(v),prevent=!0,elm.val(inst.temp[optIdx]).change())},onDestroy:function(){input.remove(),elm.removeClass("dw-hsel").removeAttr("tabindex")}}}}(jQuery);