!function($){function testTouch(e){if("touchstart"===e.type)touch=!0;else if(touch)return touch=!1,!1;return!0}function setTap(){tap=!0,setTimeout(function(){tap=!1},300)}function constrain(val,min,max){return Math.max(min,Math.min(val,max))}function convert(w){var ret={values:[],keys:[]};return $.each(w,function(k,v){ret.keys.push(k),ret.values.push(v)}),ret}$.mobiscroll.classes.Scroller=function(elem,settings){function step(e,w,func){if(e.stopPropagation(),e.preventDefault(),!click&&!isReadOnly(w)&&!w.hasClass("dwa")){click=!0;var t=w.find(".dw-ul");setGlobals(t),clearInterval(timer),timer=setInterval(function(){func(t)},s.delay),func(t)}}function isReadOnly(wh){if($.isArray(s.readonly)){var i=$(".dwwl",dw).index(wh);return s.readonly[i]}return s.readonly}function generateWheelItems(i){var html='<div class="dw-bf">',ww=wheels[i],w=ww.values?ww:convert(ww),l=1,labels=w.labels||[],values=w.values,keys=w.keys||values;return $.each(values,function(j,v){l%20==0&&(html+='</div><div class="dw-bf">'),html+='<div role="option" aria-selected="false" class="dw-li dw-v" data-val="'+keys[j]+'"'+(labels[j]?' aria-label="'+labels[j]+'"':"")+' style="height:'+hi+"px;line-height:"+hi+'px;"><div class="dw-i">'+v+"</div></div>",l++}),html+="</div>"}function setGlobals(t){min=$(".dw-li",t).index($(".dw-v",t).eq(0)),max=$(".dw-li",t).index($(".dw-v",t).eq(-1)),index=$(".dw-ul",dw).index(t)}function formatHeader(v){var t=s.headerText;return t?"function"==typeof t?t.call(e,v):t.replace(/\{value\}/i,v):""}function read(){that.temp=that.values?that.values.slice(0):s.parseValue(elm.val()||"",that),setVal()}function getCurrentPosition(t){var matrix,px,style=window.getComputedStyle?getComputedStyle(t[0]):t[0].style;return has3d?($.each(["t","webkitT","MozT","OT","msT"],function(i,v){return void 0!==style[v+"ransform"]?(matrix=style[v+"ransform"],!1):void 0}),matrix=matrix.split(")")[0].split(", "),px=matrix[13]||matrix[5]):px=style.top.replace("px",""),Math.round(m-px/hi)}function ready(t,i){clearTimeout(iv[i]),delete iv[i],t.closest(".dwwl").removeClass("dwa")}function scroll(t,index,val,time,active){var px=(m-val)*hi,style=t[0].style;px==pixels[index]&&iv[index]||(time&&px!=pixels[index]&&event("onAnimStart",[dw,index,time]),pixels[index]=px,style[pr+"Transition"]="all "+(time?time.toFixed(3):0)+"s ease-out",has3d?style[pr+"Transform"]="translate3d(0,"+px+"px,0)":style.top=px+"px",iv[index]&&ready(t,index),time&&active&&(t.closest(".dwwl").addClass("dwa"),iv[index]=setTimeout(function(){ready(t,index)},1e3*time)),pos[index]=val)}function getValid(val,t,dir){var cell=$('.dw-li[data-val="'+val+'"]',t),cells=$(".dw-li",t),v=cells.index(cell),l=cells.length;if(!cell.hasClass("dw-v")){for(var cell1=cell,cell2=cell,dist1=0,dist2=0;v-dist1>=0&&!cell1.hasClass("dw-v");)dist1++,cell1=cells.eq(v-dist1);for(;l>v+dist2&&!cell2.hasClass("dw-v");)dist2++,cell2=cells.eq(v+dist2);(dist1>dist2&&dist2&&2!==dir||!dist1||0>v-dist1||1==dir)&&cell2.hasClass("dw-v")?(cell=cell2,v+=dist2):(cell=cell1,v-=dist1)}return{cell:cell,v:v,val:cell.attr("data-val")}}function scrollToPos(time,index,manual,dir,active){event("validate",[dw,index,time,dir])!==!1&&($(".dw-ul",dw).each(function(i){var t=$(this),sc=i==index||void 0===index,res=getValid(that.temp[i],t,dir),cell=res.cell;(!cell.hasClass("dw-sel")||sc)&&(that.temp[i]=res.val,s.multiple||($(".dw-sel",t).removeAttr("aria-selected"),cell.attr("aria-selected","true")),$(".dw-sel",t).removeClass("dw-sel"),cell.addClass("dw-sel"),scroll(t,i,res.v,sc?time:.1,sc?active:!1))}),v=s.formatResult(that.temp),that.live&&setVal(manual,0,!0),$(".dwv",dw).html(formatHeader(v)),manual&&event("onChange",[v]))}function event(name,args){var ret;return args.push(that),$.each([theme,pres,settings],function(i,v){v&&v[name]&&(ret=v[name].apply(e,args))}),ret}function calc(t,val,dir,anim,orig){val=constrain(val,min,max);var cell=$(".dw-li",t).eq(val),o=void 0===orig?val:orig,active=void 0!==orig,idx=index,time=anim?val==o?.1:Math.abs((val-o)*s.timeUnit):0;that.temp[idx]=cell.attr("data-val"),scroll(t,idx,val,time,active),setTimeout(function(){scrollToPos(time,idx,!0,dir,active)},10)}function plus(t){var val=pos[index]+1;calc(t,val>max?min:val,1,!0)}function minus(t){var val=pos[index]-1;calc(t,min>val?max:val,2,!0)}function setVal(fill,time,noscroll,temp,manual){visible&&!noscroll&&scrollToPos(time,void 0,manual),v=s.formatResult(that.temp),temp||(that.values=that.temp.slice(0),that.val=v),fill&&input&&(preventChange=!0,elm.val(v).change())}function attachPosition(ev,checkLock){var debounce;wndw.on(ev,function(e){clearTimeout(debounce),debounce=setTimeout(function(){(lock&&checkLock||!checkLock)&&that.position(!checkLock)},200)})}var m,hi,v,dw,persp,overlay,ww,wh,mw,mh,lock,anim,theme,lang,click,hasButtons,scrollable,moved,start,startTime,stop,p,min,max,modal,target,index,timer,readOnly,preventChange,preventPos,wndw,doc,buttons,btn,that=this,e=elem,elm=$(e),s=extend({},defaults),pres={},iv={},pos={},pixels={},wheels=[],elmList=[],input=elm.is("input"),visible=!1,onStart=function(e){!testTouch(e)||move||click||btn||isReadOnly(this)||(e.preventDefault(),move=!0,scrollable="clickpick"!=s.mode,target=$(".dw-ul",this),setGlobals(target),moved=void 0!==iv[index],p=moved?getCurrentPosition(target):pos[index],start=getCoord(e,"Y"),startTime=new Date,stop=start,scroll(target,index,p,.001),scrollable&&target.closest(".dwwl").addClass("dwa"),$(document).on(MOVE_EVENT,onMove).on(END_EVENT,onEnd))},onMove=function(e){scrollable&&(e.preventDefault(),e.stopPropagation(),stop=getCoord(e,"Y"),scroll(target,index,constrain(p+(start-stop)/hi,min-1,max+1))),start!==stop&&(moved=!0)},onEnd=function(e){var speed,dist,tindex,time=new Date-startTime,val=constrain(p+(start-stop)/hi,min-1,max+1),ttop=target.offset().top;if(300>time?(speed=(stop-start)/time,dist=speed*speed/s.speedUnit,0>stop-start&&(dist=-dist)):dist=stop-start,tindex=Math.round(p-dist/hi),!dist&&!moved){var idx=Math.floor((stop-ttop)/hi),li=$($(".dw-li",target)[idx]),hl=scrollable;event("onValueTap",[li])!==!1?tindex=idx:hl=!0,hl&&(li.addClass("dw-hl"),setTimeout(function(){li.removeClass("dw-hl")},200))}scrollable&&calc(target,tindex,0,!0,Math.round(val)),move=!1,target=null,$(document).off(MOVE_EVENT,onMove).off(END_EVENT,onEnd)},onBtnStart=function(e){btn&&btn.removeClass("dwb-a"),btn=$(this),$(document).on(END_EVENT,onBtnEnd),btn.hasClass("dwb-d")||btn.hasClass("dwb-nhl")||btn.addClass("dwb-a"),btn.hasClass("dwwb")&&testTouch(e)&&step(e,btn.closest(".dwwl"),btn.hasClass("dwwbp")?plus:minus)},onBtnEnd=function(e){click&&(clearInterval(timer),click=!1),btn&&(btn.removeClass("dwb-a"),btn=null),$(document).off(END_EVENT,onBtnEnd)},onKeyDown=function(e){38==e.keyCode?step(e,$(this),minus):40==e.keyCode&&step(e,$(this),plus)},onKeyUp=function(e){click&&(clearInterval(timer),click=!1)},onScroll=function(e){if(!isReadOnly(this)){e.preventDefault(),e=e.originalEvent||e;var delta=e.wheelDelta?e.wheelDelta/120:e.detail?-e.detail/3:0,t=$(".dw-ul",this);setGlobals(t),calc(t,Math.round(pos[index]-delta),0>delta?1:2)}};that.position=function(check){if(!(!modal||preventPos||ww===persp.width()&&wh===(wndw[0].innerHeight||wndw.innerHeight())&&check||event("onPosition",[dw])===!1)){var w,l,t,aw,ah,ap,at,al,arr,arrw,arrl,dh,scroll,totalw=0,minw=0,sl=wndw.scrollLeft(),st=wndw.scrollTop(),wr=$(".dwwr",dw),d=$(".dw",dw),css={},anchor=void 0===s.anchor?elm:s.anchor;ww=persp.width(),wh=wndw[0].innerHeight||wndw.innerHeight(),/modal|bubble/.test(s.display)&&($(".dwc",dw).each(function(){w=$(this).outerWidth(!0),totalw+=w,minw=w>minw?w:minw}),w=totalw>ww?minw:totalw,wr.width(w).css("white-space",totalw>ww?"":"nowrap")),mw=d.outerWidth(),mh=d.outerHeight(!0),lock=wh>=mh&&ww>=mw,that.scrollLock=lock,"modal"==s.display?(l=(ww-mw)/2,t=st+(wh-mh)/2):"bubble"==s.display?(scroll=!0,arr=$(".dw-arrw-i",dw),ap=anchor.offset(),at=Math.abs($(s.context).offset().top-ap.top),al=Math.abs($(s.context).offset().left-ap.left),aw=anchor.outerWidth(),ah=anchor.outerHeight(),l=constrain(al-(d.outerWidth(!0)-aw)/2-sl,3,ww-mw-3),t=at-mh,st>t||at>st+wh?(d.removeClass("dw-bubble-top").addClass("dw-bubble-bottom"),t=at+ah):d.removeClass("dw-bubble-bottom").addClass("dw-bubble-top"),arrw=arr.outerWidth(),arrl=constrain(al+aw/2-(l+(mw-arrw)/2)-sl,0,arrw),$(".dw-arr",dw).css({left:arrl})):(css.width="100%","top"==s.display?t=st:"bottom"==s.display&&(t=st+wh-mh)),css.top=0>t?0:t,css.left=l,d.css(css),persp.height(0),dh=Math.max(t+mh,"body"==s.context?$(document).height():doc.scrollHeight),persp.css({height:dh,left:sl}),scroll&&(t+mh>st+wh||at>st+wh)&&(preventPos=!0,setTimeout(function(){preventPos=!1},300),wndw.scrollTop(Math.min(t+mh-wh,dh-wh)))}},that.enable=function(){s.disabled=!1,input&&elm.prop("disabled",!1)},that.disable=function(){s.disabled=!0,input&&elm.prop("disabled",!0)},that.setValue=function(values,fill,time,temp){that.temp=$.isArray(values)?values.slice(0):s.parseValue.call(e,values+"",that),setVal(fill,time,!1,temp,fill)},that.getValue=function(){return that.values},that.getValues=function(){var i,ret=[];for(i in that._selectedValues)ret.push(that._selectedValues[i]);return ret},that.changeWheel=function(idx,time,manual){if(dw){var i=0,nr=idx.length;$.each(s.wheels,function(j,wg){return $.each(wg,function(k,w){return $.inArray(i,idx)>-1&&(wheels[i]=w,$(".dw-ul",dw).eq(i).html(generateWheelItems(i)),nr--,!nr)?(that.position(),scrollToPos(time,void 0,manual),!1):void i++}),nr?void 0:!1})}},that.isVisible=function(){return visible},that.tap=function(el,handler){var startX,startY;s.tap&&el.on("touchstart.dw mousedown.dw",function(e){e.preventDefault(),startX=getCoord(e,"X"),startY=getCoord(e,"Y")}).on("touchend.dw",function(e){Math.abs(getCoord(e,"X")-startX)<20&&Math.abs(getCoord(e,"Y")-startY)<20&&handler.call(this,e),setTap()}),el.on("click.dw",function(e){tap||handler.call(this,e),e.preventDefault()})},that.show=function(prevAnim){if(!s.disabled&&!visible){"top"==s.display&&(anim="slidedown"),"bottom"==s.display&&(anim="slideup"),read(),event("onBeforeShow",[]);var lbl,l=0,mAnim="";anim&&!prevAnim&&(mAnim="dw-"+anim+" dw-in");var html='<div role="dialog" class="'+s.theme+" dw-"+s.display+(prefix?" dw"+prefix.replace(/\-$/,""):"")+(hasButtons?"":" dw-nobtn")+'">'+(modal?'<div class="dw-persp"><div class="dwo"></div><div class="dw dwbg '+mAnim+'"><div class="dw-arrw"><div class="dw-arrw-i"><div class="dw-arr"></div></div></div>':'<div class="dw dwbg dwi">')+'<div class="dwwr"><div aria-live="assertive" class="dwv'+(s.headerText?"":" dw-hidden")+'"></div><div class="dwcc">',isMinw=$.isArray(s.minWidth),isMaxw=$.isArray(s.maxWidth),isFixw=$.isArray(s.fixedWidth);$.each(s.wheels,function(i,wg){html+='<div class="dwc'+("scroller"!=s.mode?" dwpm":" dwsc")+(s.showLabel?"":" dwhl")+'"><div class="dwwc dwrc"><table cellpadding="0" cellspacing="0"><tr>',$.each(wg,function(j,w){wheels[l]=w,lbl=void 0!==w.label?w.label:j,html+='<td><div class="dwwl dwrc dwwl'+l+'">'+("scroller"!=s.mode?'<a href="#" tabindex="-1" class="dwb-e dwwb dwwbp" style="height:'+hi+"px;line-height:"+hi+'px;"><span>+</span></a><a href="#" tabindex="-1" class="dwb-e dwwb dwwbm" style="height:'+hi+"px;line-height:"+hi+'px;"><span>&ndash;</span></a>':"")+'<div class="dwl">'+lbl+'</div><div tabindex="0" aria-live="off" aria-label="'+lbl+'" role="listbox" class="dwww"><div class="dww" style="height:'+s.rows*hi+"px;"+(s.fixedWidth?"width:"+(isFixw?s.fixedWidth[l]:s.fixedWidth)+"px;":(s.minWidth?"min-width:"+(isMinw?s.minWidth[l]:s.minWidth)+"px;":"min-width:"+s.width+"px;")+(s.maxWidth?"max-width:"+(isMaxw?s.maxWidth[l]:s.maxWidth)+"px;":""))+'"><div class="dw-ul">',html+=generateWheelItems(l),html+='</div><div class="dwwol"></div></div><div class="dwwo"></div></div><div class="dwwol"></div></div></td>',l++}),html+="</tr></table></div></div>"}),html+="</div>",modal&&hasButtons&&(html+='<div class="dwbc">',$.each(buttons,function(i,b){b="string"==typeof b?that.buttons[b]:b,html+="<span"+(s.btnWidth?' style="width:'+100/buttons.length+'%"':"")+' class="dwbw '+b.css+'"><a href="#" class="dwb dwb'+i+' dwb-e" role="button">'+b.text+"</a></span>"}),html+="</div>"),html+=(modal?"</div>":"")+"</div></div></div>",dw=$(html),persp=$(".dw-persp",dw),overlay=$(".dwo",dw),scrollToPos(),event("onMarkupReady",[dw]),modal?(dw.appendTo(s.context),anim&&!prevAnim&&(dw.addClass("dw-trans"),setTimeout(function(){dw.removeClass("dw-trans").find(".dw").removeClass(mAnim)},350))):elm.is("div")?elm.html(dw):dw.insertAfter(elm),event("onMarkupInserted",[dw]),visible=!0,modal&&($(window).on("keydown.dw",function(e){13==e.keyCode?that.select():27==e.keyCode&&that.cancel()}),s.scrollLock&&dw.on("touchmove",function(e){lock&&e.preventDefault()}),$("input,select,button",doc).each(function(){this.disabled||($(this).attr("autocomplete")&&$(this).data("autocomplete",$(this).attr("autocomplete")),$(this).addClass("dwtd").prop("disabled",!0).attr("autocomplete","off"))}),that.position(),attachPosition("orientationchange.dw resize.dw",!1),attachPosition("scroll.dw",!0)),dw.on("DOMMouseScroll mousewheel",".dwwl",onScroll).on("keydown",".dwwl",onKeyDown).on("keyup",".dwwl",onKeyUp).on("selectstart mousedown",prevdef).on("click",".dwb-e",prevdef).on("touchend",function(){s.tap&&setTap()}).on("keydown",".dwb-e",function(e){32==e.keyCode&&(e.preventDefault(),e.stopPropagation(),$(this).click())}),setTimeout(function(){$.each(buttons,function(i,b){that.tap($(".dwb"+i,dw),function(e){b="string"==typeof b?that.buttons[b]:b,b.handler.call(this,e,that)})}),s.closeOnOverlay&&that.tap(overlay,function(){that.cancel()}),dw.on(START_EVENT,".dwwl",onStart).on(START_EVENT,".dwb-e",onBtnStart)},300),event("onShow",[dw,v])}},that.hide=function(prevAnim,btn,force){if(visible&&(force||event("onClose",[v,btn])!==!1)){if($(".dwtd",doc).each(function(){$(this).prop("disabled",!1).removeClass("dwtd"),$(this).data("autocomplete")?$(this).attr("autocomplete",$(this).data("autocomplete")):$(this).removeAttr("autocomplete")}),dw){var doAnim=modal&&anim&&!prevAnim;doAnim&&dw.addClass("dw-trans").find(".dw").addClass("dw-"+anim+" dw-out"),prevAnim?dw.remove():setTimeout(function(){dw.remove(),activeElm&&(preventShow=!0,activeElm.focus())},doAnim?350:1),wndw.off(".dw")}pixels={},visible=!1}},that.select=function(){that.hide(!1,"set")!==!1&&(setVal(!0,0,!0),event("onSelect",[that.val]))},that.attachShow=function(elm,beforeShow){elmList.push(elm),"inline"!==s.display&&elm.on((s.showOnFocus?"focus.dw":"")+(s.showOnTap?" click.dw":""),function(ev){"focus"===ev.type&&("focus"!==ev.type||preventShow)||tap||(beforeShow&&beforeShow(),activeElm=elm,that.show()),setTimeout(function(){preventShow=!1},300)})},that.cancel=function(){that.hide(!1,"cancel")!==!1&&event("onCancel",[that.val])},that.init=function(ss){theme=ms.themes[ss.theme||s.theme],lang=ms.i18n[ss.lang||s.lang],extend(settings,ss),event("onThemeLoad",[lang,settings]),extend(s,theme,lang,settings),s.buttons=s.buttons||["set","cancel"],s.headerText=void 0===s.headerText?"inline"!==s.display?"{value}":!1:s.headerText,that.settings=s,elm.off(".dw");var preset=ms.presets[s.preset];preset&&(pres=preset.call(e,that),extend(s,pres,settings)),m=Math.floor(s.rows/2),hi=s.height,anim=s.animate,modal="inline"!==s.display,buttons=s.buttons,wndw=$("body"==s.context?window:s.context),doc=$(s.context)[0],s.setText||buttons.splice($.inArray("set",buttons),1),s.cancelText||buttons.splice($.inArray("cancel",buttons),1),s.button3&&buttons.splice($.inArray("set",buttons)+1,0,{text:s.button3Text,handler:s.button3}),that.context=wndw,that.live=!modal||-1==$.inArray("set",buttons),that.buttons.set={text:s.setText,css:"dwb-s",handler:that.select},that.buttons.cancel={text:that.live?s.closeText:s.cancelText,css:"dwb-c",handler:that.cancel},that.buttons.clear={text:s.clearText,css:"dwb-cl",handler:function(){that.trigger("onClear",[dw]),elm.val(""),that.live||that.hide()}},hasButtons=buttons.length>0,visible&&that.hide(!0,!1,!0),modal?(read(),input&&(void 0===readOnly&&(readOnly=e.readOnly),e.readOnly=!0),that.attachShow(elm)):that.show(),input&&elm.on("change.dw",function(){preventChange||that.setValue(elm.val(),!1,.2),preventChange=!1})},that.option=function(opt,value){var obj={};"object"==typeof opt?obj=opt:obj[opt]=value,that.init(obj)},that.destroy=function(){that.hide(!0,!1,!0),$.each(elmList,function(i,v){v.off(".dw")}),$(window).off(".dwa"),input&&(e.readOnly=readOnly),delete instances[e.id],event("onDestroy",[])},that.getInst=function(){return that},that.getValidCell=getValid,that.trigger=event,instances[e.id]=that,that.values=null,that.val=null,that.temp=null,that.buttons={},that._selectedValues={},that.init(settings)};var activeElm,move,tap,touch,preventShow,ms=$.mobiscroll,instances=ms.instances,util=ms.util,prefix=util.prefix,pr=util.jsPrefix,has3d=util.has3d,getCoord=util.getCoord,prevdef=function(e){e.preventDefault()},extend=$.extend,START_EVENT="touchstart mousedown",MOVE_EVENT="touchmove mousemove",END_EVENT="touchend mouseup",defaults={width:70,height:40,rows:3,delay:300,disabled:!1,readonly:!1,closeOnOverlay:!0,showOnFocus:!0,showOnTap:!0,showLabel:!0,wheels:[],theme:"sense-ui",selectedText:" Selected",closeText:"Close",display:"modal",mode:"scroller",preset:"",lang:"zh",setText:"Set",cancelText:"Cancel",clearText:"Clear",context:"body",scrollLock:!0,tap:!0,btnWidth:!0,speedUnit:.0012,timeUnit:.1,formatResult:function(d){return d.join(" ")},parseValue:function(value,inst){var keys,val=value.split(" "),ret=[],i=0;return $.each(inst.settings.wheels,function(j,wg){$.each(wg,function(k,w){w=w.values?w:convert(w),keys=w.keys||w.values,-1!==$.inArray(val[i],keys)?ret.push(val[i]):ret.push(keys[0]),i++})}),ret}};$(window).on("focus",function(){activeElm&&(preventShow=!0)}),$(document).on("mouseover mouseup mousedown click",function(e){return tap?(e.stopPropagation(),e.preventDefault(),!1):void 0}),$.mobiscroll.setDefaults=function(o){extend(defaults,o)}}(jQuery);