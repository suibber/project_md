define(function(require,exports){return{validate:function(formName,validateRules,showStyle,options){function addValid(rules,hideline){if("object"==typeof rules){var validObj={};for(var key in rules)if(!itemSetForLine[key]){itemSetForLine[key]=[];var rule=rules[key];for(var item in rule){var infoArr=item.split("=");itemSetForLine[key][infoArr[0]]=[ruleSet[infoArr[0]],infoArr[1],rule[item]]}validObj[key]=itemSetForLine[key]}hideline||showMsgByLine(validObj)}}function showSuccessIcon(itemObj){if(options.success){var suc=options.success.split("="),ele=itemObj.parentNode.getElementsByTagName(suc[0])[0];ele&&(ele.className=suc[1])}}function showErrorIcon(itemObj){if(options.error){var err=options.error.split("="),ele=itemObj.parentNode.getElementsByTagName(err[0])[0];ele&&(ele.className=err[1])}}function resetItemAll(){for(var itemName in itemSetForLine){var itemObj=formElements[itemName];resetItem(itemObj)}}function resetItem(itemObj){var e=document.getElementById("msg"+itemObj.name);if(e&&e.parentNode.removeChild(e),options.success){var suc=options.success.split("=");itemObj.parentNode.getElementsByTagName(suc[0])[0].className=""}if(options.error){var err=options.error.split("=");itemObj.parentNode.getElementsByTagName(err[0])[0].className=""}}function checkItem(itemSet,itemObj,msgItemClass){msgTipBox&&(msgItemClass=msgTipBox);var itemValidate=itemSet[itemObj.name];for(var k in itemValidate){var e=document.getElementById("msg"+itemObj.name);if(e&&e.parentNode.removeChild(e),"indexOf"!=k&&!itemValidate[k][0](itemObj,itemValidate[k][1]))return showMsgOnLine(itemObj,itemValidate[k][2],msgItemClass),!1}return options.isExist&&options.isExist[itemObj.name]?valiedateIsExist(itemObj,msgItemClass,options.isExist[itemObj.name]):showSuccessIcon(itemObj),!0}function showMsgByLine(itemSet,msgItemClass,cbk){for(var itemName in itemSet){var itemObj=formElements[itemName];itemObj.onblur=function(){checkItem(itemSet,this,msgItemClass)},"checkbox"===itemObj.type&&(itemObj.onclick=function(){checkItem(itemSet,this,msgItemClass)})}"function"==typeof cbk&&cbk()}function insertAfter(newEl,targetEl){cleanWhitespace(formObj);var parentEl=targetEl.parentNode;parentEl.appendChild(newEl)}function cleanWhitespace(oEelement){for(var i=0;i<oEelement.childNodes.length;i++){var node=oEelement.childNodes[i];3!=node.nodeType||/\S/.test(node.nodeValue)||node.parentNode.removeChild(node)}}function insertTip(itemObj,errTip,msgItemClass){if("string"==typeof errTip){if(""===errTip)return void showSuccessIcon(itemObj);showErrorIcon(itemObj);var messageBox=(getElementsByClass(msgItemClass),document.createElement("div"));messageBox.setAttribute("id","msg"+itemObj.name),messageBox.className=msgItemClass,messageBox.innerHTML="<span></span>"+errTip,insertAfter(messageBox,itemObj)}}function showMsgOnLine(itemObj,err,msgItemClass){var insertTips=function(errTip){insertTip(itemObj,errTip,msgItemClass)};return"function"==typeof err?void err(insertTips):void insertTips(err)}function showMsgByOne(itemSet,msgItemClass,cbk){var msgClass=msgItemClass.split("."),msgItem=getElementsByClass(msgClass[0],formObj)[0];msgItem.onclick=function(){for(var itemName in itemSet){var itemObj=formElements[itemName],itemValidate=itemSet[itemObj.name];for(var k in itemValidate)if("indexOf"!=k&&!itemValidate[k][0](itemObj,itemValidate[k][1]))return void(getElementsByClass(msgClass[1],formObj)[0].innerHTML=itemValidate[k][2])}"function"==typeof cbk&&cbk()}}function showMsgForSubmit(itemSet,msgItemClass,cbk){var msgItem=getElementsByClass(msgItemClass)[0];msgItem.onclick=function(){for(var itemName in itemSet){var itemObj=formElements[itemName];if(!itemObj.getAttribute("novalid")&&!checkItem(itemSet,itemObj,msgItemClass))return}clearTimeout(timeoutID),timeoutID=setTimeout(function(){for(var itemName in itemSet){var itemObj=formElements[itemName],err=options.error.split("="),errIcon=itemObj.parentNode.getElementsByTagName(err[0])[0];if(errIcon&&(errIcon.className==err[1]||""==errIcon.className))return}"function"==typeof cbk&&cbk()},500)}}function getElementsByClass(searchClass,domNode,tagName){null==domNode&&(domNode=document),null==tagName&&(tagName="*");var el=new Array,tags=domNode.getElementsByTagName(tagName),tcl=" "+searchClass+" ";for(i=0,j=0;i<tags.length;i++){var test=" "+tags[i].className+" ";-1!=test.indexOf(tcl)&&(el[j++]=tags[i])}return el}function validateRequired(itemObj,defaultVal){var itemVal=itemObj.value;return""!=itemVal&&itemVal!=defaultVal}function validateMaxLen(itemObj,maxLen){return itemObj.value.length<=maxLen}function validateMinLen(itemObj,minLen){return itemObj.value.length>=minLen}function validateEmail(itemObj){var re=/^([a-zA-Z0-9]+[_|\_|\.|\-]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;return re.test(itemObj.value)}function validateMobile(itemObj){var re=/^\d{11}$/;return re.test(itemObj.value)}function validateTel(itemObj){var re=/^(([0\+]\d{2,3}-)?(0\d{2,3}-?)|400|800)(\d{7,8})(-(\d+))?$/;return re.test(itemObj.value)}function validatePhone(itemObj){return validateMobile(itemObj)||validateTel(itemObj)}function validatePostcode(itemObj){var re=/^[0-9]{6}$/;return re.test(itemObj.value)}function validateSupportEmail(itemObj,emailName){var emails={yahoo:["@yahoo","@ymail"]};if(!(emailName in emails))return!0;for(var flag=!0,email=emails[emailName],i=email.length;i--;)if(itemObj.value.indexOf(email[i])>-1){flag=!1;break}return flag}function validateCompare(itemObj,compareItem){var comparedItemVal=document.forms[formName].elements[compareItem].value;return""==comparedItemVal||""==itemObj.value?!0:itemObj.value===comparedItemVal}function validateSelectMax(itemObj,maxNum){var num=0;for(var r in itemObj)itemObj[r].checked&&num++;return maxNum>num}function validateSelectMin(itemObj,minNum){var num=0;for(var r in itemObj)itemObj[r].checked&&num++;return num>minNum}function validateSelectRadio(itemObj){return itemObj.checked}function valiedateIsExist(itemObj,msgItemClass,cbk){cbk(function(errTip){insertTip(itemObj,errTip,msgItemClass)})}function validatePhoneOrMobile(itemObj){return validatePhone(itemObj)||validateMobile(itemObj)}var formObj=document.forms[formName];if(!formObj)return void alert("不存在这个表单:"+formName);var ruleSet={req:validateRequired,maxlen:validateMaxLen,minlen:validateMinLen,email:validateEmail,canEmail:validateSupportEmail,mobile:validateMobile,tel:validateTel,phone:validatePhone,postcode:validatePostcode,compare:validateCompare,selectmax:validateSelectMax,selectmin:validateSelectMin,selectradio:validateSelectRadio,contact:validatePhoneOrMobile},styleSet={showmsgbyline:showMsgByLine,showmsgforsubmit:showMsgForSubmit,showmsgbyone:showMsgByOne},msgTipBox="",formElements=formObj.elements,itemSetForLine={};if("object"!=typeof validateRules)return void alert("错误, validateRules参数错误... ");for(var itemName in validateRules){var rules=validateRules[itemName];formElements[itemName];itemSetForLine[itemName]=[];for(var rule in rules){var pos,arg,err=rules[rule];-1!=(pos=rule.indexOf("="))&&(arg=rule.substring(pos+1),rule=rule.substring(0,pos));var ruleFun=ruleSet[rule];if(!ruleFun)return void alert("错误, 不存在这个验证规则");itemSetForLine[itemName][rule]=[ruleFun,arg,err]}}for(var style in showStyle){var s=style.split("=");"showmsgbyline"==s[0]&&(msgTipBox=s[1]),styleSet[s[0]](itemSetForLine,s[1],showStyle[style])}var timeoutID;return{resetForm:resetItemAll,addValid:addValid}}}});