define(function(require,exports){function authCodeTimer(count,$this,delay){setTimeout(function(){$this.text("重新获取"+count+"s"),count--,count>0?authCodeTimer(count,$this,1e3):($this.text("重新获取"),$this.removeClass("auth-code-sleep"))},delay||0)}require("zepto-ext");var api=require("../widget/api"),duang=(require("../widget/util"),require("../widget/duang"));$(".auth-code-btn").on("click",function(){if(!$(this).hasClass("auth-code-sleep")){var $this=$(this);$.post(api.gen("entry/vcode-for-signup"),{phonenum:$(".tel-reg-tel").find("input").val()},function(data){data.success?($this.addClass("auth-code-sleep"),authCodeTimer(60,$this)):duang.toast(data.message)},"json")}}),$(".reg-btn").on("click",function(){var param={};param.phonenum=$(".tel-reg-tel-input").val(),param.code=$(".tel-reg-code-input").val(),param.password=$(".tel-reg-passwd-input").val(),param.invited_by=$(".tel-reg-invitation-input").val(),$.post(api.gen("entry/signup"),param,function(data){function loginSucc(){duang.toast(data.message,function(){window.cookie.set("user",JSON.stringify(data.result)),history.back()})}0==data.success?duang.toast(data.message):(miduoduo.user.access_token=data.result.access_token,miduoduo.wechatOpenId?$.post(api.gen("user/bind-third-party-account"),{platform:"wechat",params:{openid:miduoduo.wechatOpenId}},function(data2){0==data2.success&&duang.toast(data2.message),loginSucc()},"json"):loginSucc())},"json")})});