define(function(require,exports){require("zepto-ext");var homeID,tpl=require("../widget/tpl-engine"),api=require("../widget/api"),util=require("../widget/util"),duang=require("../widget/duang");$(window).on("hashchange",function(){""==location.hash?($("#mdd-map").css("right","100%"),$("html").removeClass("body-act"),$("body").removeClass("body-act")):($("html").addClass("body-act"),$("body").addClass("body-act"))}),$.get(api.gen("resume?expand=service_types,freetimes,home_address,workplace_address"),function(data){var user=data.items[0];$("body").append(tpl.parse("main-tpl",{user:user}));var $days=$(".dateTitle"),freeTimes=user.freetimes;freeTimes.forEach(function(e){var $day=$days.eq(e.dayofweek-1),$times=$day.siblings();1==e.morning&&$times.eq(0).addClass("time-act"),1==e.afternoon&&$times.eq(1).addClass("time-act"),1==e.evening&&$times.eq(2).addClass("time-act")}),$(".sex").find("div").on("click",function(){$(this).addClass("sex-act").siblings().removeClass("sex-act")}),$(".sub2-con-val").on("click",function(){$(this).toggleClass("sub2-con-val-act")});var timeName=["morning","afternoon","evening"];$(".dateCol > .time").on("click",function(){var $this=$(this),classStr="time-act",dayIndex=$this.parent().index()+1,timeIndex=$this.index()-1,data={};$this.hasClass(classStr)?($this.removeClass(classStr),data[timeName[timeIndex]]=0):($this.addClass(classStr),data[timeName[timeIndex]]=1),$.put(api.gen("freetime/"+dayIndex),data,function(data){})}),$(".freetime-all").on("click",function(){$(".dateCol > .time").addClass("time-act"),$.post(api.gen("freetime/free-all"),{},function(data){})}),$(".js-sel-service-type").on("click",function(){$(".sel-job-type").show();var typeCodeStr=$(this).find("input").val();if($(this).find("input").val(""),typeCodeStr){var typeCode=typeCodeStr.split(",");typeCode.forEach(function(e){$(".type-item[data-code='"+e+"']").addClass("type-act")})}}),$(".js-set-address").on("click",function(){window.location.hash="map",$("#mdd-map").css("right",0),""!=$(this).text().replace(/ /g,"")&&$("#mdd-map")[0].contentWindow.setMapLocation($(this).text())}),window.setHomeLocation=function(homeLocationParam){$.post(api.gen("address"),homeLocationParam,function(data){homeID=data.id})},require("./resume-job-type"),$(".submit-btn").on("click",function(){var data={};$(".js-col").each(function(){data[$(this).attr("name")]=$(this).val()});var $sc=$(".js-special-col");data[$sc.attr("name")]=$sc.find(".sex-act").data("val"),data.home=homeID,$.put(api.gen("resume/"+miduoduo.user.id),data,function(data){duang.toast("修改成功",function(){window.location.replace(util.addUrlParam(document.referrer,"page_back_two"))})})})})});