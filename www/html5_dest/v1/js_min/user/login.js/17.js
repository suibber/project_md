define(function(require,exports){function authCodeTimer(count,$this,delay){setTimeout(function(){$this.text("重新获取"+count+"s"),count--,count>0?authCodeTimer(count,$this,1e3):($this.text("重新获取"),$this.removeClass("auth-code-sleep"))},delay||0)}require("zepto-ext");var duang=require("../widget/duang"),api=require("../widget/api"),$li=(require("../widget/util"),$(".form-area").find("li"));$(".top").find("div").on("click",function(){var $span=$(this).find("span");$span.addClass("top-act"),$(this).siblings().find("span").removeClass("top-act"),$li.eq($(this).index()).addClass("form-area-act").siblings().removeClass("form-area-act")}),$(".auth-code-btn").on("click",function(){if(!$(this).hasClass("auth-code-sleep")){var $this=$(this);$.post(api.gen("entry/vcode"),{phonenum:$(".tel-login-tel").find("input").val()},function(data){data.success?($this.addClass("auth-code-sleep"),authCodeTimer(60,$this)):duang.toast(data.message)},"json")}}),$(".login-btn").on("click",function(){var url,param,i=$(".top-act").parent().index();switch(i){case 0:url="entry/login",param={phonenum:$(".text-login-tel-input").val(),password:$(".text-login-passwd-input").val()};break;case 1:param={phonenum:$(".tel-login-tel-input").val(),code:$(".tel-login-passwd-input").val()},url="entry/vlogin"}$.post(api.gen(url),param,function(data){function loginSucc(){duang.toast(data.message,function(){window.cookie.set("user",JSON.stringify(data.result)),history.back()})}if(0==data.success)duang.toast(data.message);else if(miduoduo.user.access_token=data.result.access_token,miduoduo.wechatOpenId){var openid={openid:miduoduo.wechatOpenId},params={platform:"wechat",params:openid};$.post(api.gen("user/bind-third-party-account"),params,function(data2){0==data2.success&&duang.toast(data2.message),loginSucc()},"json")}else loginSucc()},"json")})});